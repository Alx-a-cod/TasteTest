@{
    ViewData["Title"] = "Home Page";
}
@model List<OrdineViewModel>

<!-- Bootstrap + Select2 CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css" rel="stylesheet" />

<!-- jQuery + Bootstrap JS + Select2 -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.min.js"></script>


<div class="container mt-4">
    <h4 class="mb-4">Ordini</h4>

    <table id="tabellaOrdini" class="sirio-table sirio-table-dark">
        <thead>
            <tr>
                <th>Cliente</th>
                <th>Prezzo Totale</th>
                <th>Azioni</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var ordine in Model)
            {
                <tr data-idordine="@ordine.IDOrdine">
                    <td>@ordine.Cliente</td>
                    <td>@ordine.Totale.ToString("F2") €</td>
                    <td>
                        <div class="d-flex gap-2">
                            <button class="sirio-btn sirio-btn-icon" title="Dettaglio ordine">
                                <i class="fas fa-eye" style="color: #7C6E7F"></i>
                            </button>
                            <button class="sirio-btn sirio-btn-danger p-2" title="Elimina ordine">
                                <i class="fa-solid fa-trash fa-24"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

<!-- Modal Dettaglio Ordine -->
<div class="modal fade" id="modalDettaglio" tabindex="-1" role="dialog" aria-labelledby="dettaglioLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
        <div class="modal-content border-0 shadow-sm">
            <!-- <°)))>< valutare se aggiungere un header? Per il momento unnecessary. -->
            <div class="modal-body" id="contenutoDettaglio">
                <div class="text-center text-muted my-4">
                    <div class="spinner-border text-primary" role="status">
                        <span class="sr-only">Caricamento...</span>
                    </div>
                    <p class="mt-3">Caricamento dei dettagli ordine...</p>
                </div>
            </div>
        </div>
    </div>
</div>


@* <!-- Modal Dettaglio Ordine -->
<div class="modal fade" id="modalDettaglio" tabindex="-1" role="dialog" aria-labelledby="dettaglioLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Dettaglio Ordine</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Chiudi">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="contenutoDettaglio">
                <!-- Dettagli caricati via AJAX -->
            </div>
        </div>
    </div>
 *@

<!-- Script AJAX -->
<script>
    $(document).ready(function () {
        // Eliminazione ordine
        $(document).on("click", ".sirio-btn-danger", function () {
            let row = $(this).closest("tr");
            let idOrdine = row.data("idordine");

            if (confirm("Sei sicuro di voler eliminare questo ordine?")) {
                $.ajax({
                    url: "/Home/DeleteOrdine",
                    method: "POST",
                    data: { ordineId: idOrdine },
                    success: function (response) {
                        if (response.success) {
                            alert("Ordine eliminato con successo.");
                            row.remove(); // oppure location.reload();
                        } else {
                            alert("Errore nell'eliminazione: " + response.message);
                        }
                    },
                    error: function () {
                        alert("Errore nella richiesta.");
                    }
                });
            }
        });

        // Visualizza dettaglio ordine
        $(document).on("click", ".sirio-btn-icon", function () {
            let row = $(this).closest("tr");
            let idOrdine = row.data("idordine");

            $.ajax({
                url: "/Home/GetDettagliOrdine",
                method: "GET",
                data: { ordineId: idOrdine },
                success: function (html) {
                    $("#contenutoDettaglio").html(html);
                    $("#modalDettaglio").modal("show");
                },
                error: function () {
                    alert("Errore nel recupero del dettaglio ordine.");
                }
            });
        });
    });
</script>